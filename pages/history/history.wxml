<!--pages/history/history.wxml-->
<view class="history-container">
  <!-- Header -->
  <view class="history-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="header-title">å†å²è®°å½•</text>
    <view class="header-right" bindtap="toggleSortMenu">
      <text class="sort-icon">â‰¡</text>
    </view>
  </view>

  <!-- Search Bar -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        placeholder="æœç´¢è®°å½•..."
        placeholder-class="search-ph"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
      />
      <text wx:if="{{searchQuery}}" class="clear-icon" bindtap="clearSearch">âœ•</text>
    </view>
  </view>

  <!-- Sort Menu -->
  <view wx:if="{{showSortMenu}}" class="sort-menu" catchtap="toggleSortMenu">
    <view class="sort-menu-content" catchtap="stopPropagation">
      <text class="sort-menu-title">æ’åºæ–¹å¼</text>
      <view class="sort-options">
        <view
          class="sort-option {{sortBy === 'date' ? 'active' : ''}}"
          bindtap="selectSort"
          data-sort="date">
          <text class="option-label">æ—¥æœŸ</text>
          <text wx:if="{{sortBy === 'date'}}" class="order-icon">{{sortOrder === 'desc' ? 'â†“' : 'â†‘'}}</text>
        </view>
        <view
          class="sort-option {{sortBy === 'intensity' ? 'active' : ''}}"
          bindtap="selectSort"
          data-sort="intensity">
          <text class="option-label">å¼ºåº¦</text>
          <text wx:if="{{sortBy === 'intensity'}}" class="order-icon">{{sortOrder === 'desc' ? 'â†“' : 'â†‘'}}</text>
        </view>
        <view
          class="sort-option {{sortBy === 'duration' ? 'active' : ''}}"
          bindtap="selectSort"
          data-sort="duration">
          <text class="option-label">æ—¶é•¿</text>
          <text wx:if="{{sortBy === 'duration'}}" class="order-icon">{{sortOrder === 'desc' ? 'â†“' : 'â†‘'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Logs List -->
  <scroll-view
    class="logs-scroll"
    scroll-y="true"
    bindscrolltolower="loadMore"
    refresher-enabled="true"
    refresher-triggered="{{loading}}"
    bindrefresherrefresh="onPullDownRefresh">

    <view wx:if="{{filteredLogs.length > 0}}" class="logs-list">
      <view
        wx:for="{{filteredLogs}}"
        wx:key="id"
        class="log-item"
        bindtap="editLog"
        data-id="{{item.id}}">
        <view class="log-content">
          <text class="log-title">{{item.title}}</text>

          <!-- Experience intensity bar -->
          <view class="log-intensity-section">
            <view class="log-intensity-bar">
              <view class="intensity-fill level-{{item.intensityLevel}}" style="width: {{item.intensity * 20}}%"></view>
            </view>
            <text class="intensity-score">{{item.intensity}}</text>
          </view>

          <!-- Duration display -->
          <view class="log-meta">
            <text class="meta-text">{{item.duration}}åˆ†é’Ÿ</text>
          </view>
        </view>
        <text class="log-time">{{item.timeDisplay}}</text>
      </view>
    </view>

    <!-- Empty state -->
    <view wx:else class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— è®°å½•</text>
      <text wx:if="{{searchQuery}}" class="empty-hint">è¯•è¯•å…¶ä»–æœç´¢å…³é”®è¯</text>
    </view>

    <!-- Load more indicator -->
    <view wx:if="{{filteredLogs.length > 0 && hasMore}}" class="load-more">
      <text class="load-more-text">åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- No more data indicator -->
    <view wx:if="{{filteredLogs.length > 0 && !hasMore}}" class="no-more">
      <text class="no-more-text">å·²åŠ è½½å…¨éƒ¨è®°å½•</text>
    </view>
  </scroll-view>
</view>
